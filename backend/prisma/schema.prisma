generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String
  email     String   @unique
  password  String
  role      UserRole @default(CASHIER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[] @relation("CashierOrders")
}

enum UserRole {
  CASHIER
  ADMIN
}

model Category {
  id   Int    @id @default(autoincrement())
  name String @unique

  menus Menu[]
}

model Menu {
  id         Int      @id @default(autoincrement())
  name       String
  price      Int
  categoryId Int
  imageUrl   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  category Category @relation(fields: [categoryId], references: [id])

  orderItems OrderItem[]
}

model Order {
  id           Int     @id @default(autoincrement())
  customerName String
  notes        String?
  tableNumber  String?

  paymentType PaymentType @default(CASH)

  paymentId String? @unique

  cashierId Int?
  cashier   User? @relation("CashierOrders", fields: [cashierId], references: [id])

  status OrderStatus @default(PENDING)

  subTotal       Int @default(0)
  taxAmount      Int @default(0)
  serviceAmount  Int @default(0)
  discountAmount Int @default(0)
  totalPrice     Int @default(0)

  paidAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  items OrderItem[]
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  menuId    Int
  quantity  Int      @default(1)
  price     Int
  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menu  Menu  @relation(fields: [menuId], references: [id])
}

model GlobalSetting {
  id Int @id @default(1) // Selalu gunakan ID 1

  // Pengaturan Pajak Global
  taxPercentage Float   @default(0)
  isTaxActive   Boolean @default(false)

  // Pengaturan Layanan Global
  servicePercentage Float   @default(0)
  isServiceActive   Boolean @default(false)

  // Pengaturan Diskon Global
  discountPercentage Float   @default(0)
  isDiscountActive   Boolean @default(false)

  updatedAt DateTime @updatedAt
}

enum OrderStatus {
  PENDING // Belum dibayar (untuk CASH) atau sedang proses bayar (untuk GATEWAY)
  CONFIRMED // Sudah dibayar & dikonfirmasi (baik lewat Webhook PG atau klik manual Admin)
  FAILED
}

enum PaymentType {
  GATEWAY
  CASH
  QRIS
  DEBIT
  CREDIT
  TRANSFER
}
